CONST
   ENCODER_A1 = 11
   ENCODER_C4 = 19
VAR
   long rawBits
   long altitude
   long myStack[16]

PUB Start
   Initialize
   cognew(PollLoop, @myStack)

PUB Initialize
   dira[ENCODER_A1 .. ENCODER_C4] := 0

PUB GetAltitude
   return altitude

PUB GetRawBits
   return rawBits    

PUB Poll
   rawBits := ina[ENCODER_A1 .. ENCODER_C4]
   rawBits := (!rawBits) & $1FF
   altitude := DecodeBits(rawBits)

PUB PollLoop
   repeat
       Poll

PUB DecodeBits(bits) | row
    repeat row from 0 to 313
        if word[@GREYCODE + row*2] == bits
            return -1200 + row*100
    return 0 

DAT
    GREYCODE
       word %000000001 '-1200
       word %000000011 '-1100
       word %000000010 '-1000
       word %000000110 '-900
       word %000000100 '-800
       word %000001100 '-700
       word %000001110 '-600
       word %000001010 '-500
       word %000001011 '-400
       word %000001001 '-300
       word %000011001 '-200
       word %000011011 '-100
       word %000011010 '0
       word %000011110 '100
       word %000011100 '200
       word %000010100 '300
       word %000010110 '400
       word %000010010 '500
       word %000010011 '600
       word %000010001 '700
       word %000110001 '800
       word %000110011 '900
       word %000110010 '1000
       word %000110110 '1100
       word %000110100 '1200
       word %000111100 '1300
       word %000111110 '1400
       word %000111010 '1500
       word %000111011 '1600
       word %000111001 '1700
       word %000101001 '1800
       word %000101011 '1900
       word %000101010 '2000
       word %000101110 '2100
       word %000101100 '2200
       word %000100100 '2300
       word %000100110 '2400
       word %000100010 '2500
       word %000100011 '2600
       word %000100001 '2700
       word %001100001 '2800
       word %001100011 '2900
       word %001100010 '3000
       word %001100110 '3100
       word %001100100 '3200
       word %001101100 '3300
       word %001101110 '3400
       word %001101010 '3500
       word %001101011 '3600
       word %001101001 '3700
       word %001111001 '3800
       word %001111011 '3900
       word %001111010 '4000
       word %001111110 '4100
       word %001111100 '4200
       word %001110100 '4300
       word %001110110 '4400
       word %001110010 '4500
       word %001110011 '4600
       word %001110001 '4700
       word %001010001 '4800
       word %001010011 '4900
       word %001010010 '5000
       word %001010110 '5100
       word %001010100 '5200
       word %001011100 '5300
       word %001011110 '5400
       word %001011010 '5500
       word %001011011 '5600
       word %001011001 '5700
       word %001001001 '5800
       word %001001011 '5900
       word %001001010 '6000
       word %001001110 '6100
       word %001001100 '6200
       word %001000100 '6300
       word %001000110 '6400
       word %001000010 '6500
       word %001000011 '6600
       word %001000001 '6700
       word %011000001 '6800
       word %011000011 '6900
       word %011000010 '7000
       word %011000110 '7100
       word %011000100 '7200
       word %011001100 '7300
       word %011001110 '7400
       word %011001010 '7500
       word %011001011 '7600
       word %011001001 '7700
       word %011011001 '7800
       word %011011011 '7900
       word %011011010 '8000
       word %011011110 '8100
       word %011011100 '8200
       word %011010100 '8300
       word %011010110 '8400
       word %011010010 '8500
       word %011010011 '8600
       word %011010001 '8700
       word %011110001 '8800
       word %011110011 '8900
       word %011110010 '9000
       word %011110110 '9100
       word %011110100 '9200
       word %011111100 '9300
       word %011111110 '9400
       word %011111010 '9500
       word %011111011 '9600
       word %011111001 '9700
       word %011101001 '9800
       word %011101011 '9900
       word %011101010 '10000
       word %011101110 '10100
       word %011101100 '10200
       word %011100100 '10300
       word %011100110 '10400
       word %011100010 '10500
       word %011100011 '10600
       word %011100001 '10700
       word %010100001 '10800
       word %010100011 '10900
       word %010100010 '11000
       word %010100110 '11100
       word %010100100 '11200
       word %010101100 '11300
       word %010101110 '11400
       word %010101010 '11500
       word %010101011 '11600
       word %010101001 '11700
       word %010111001 '11800
       word %010111011 '11900
       word %010111010 '12000
       word %010111110 '12100
       word %010111100 '12200
       word %010110100 '12300
       word %010110110 '12400
       word %010110010 '12500
       word %010110011 '12600
       word %010110001 '12700
       word %010010001 '12800
       word %010010011 '12900
       word %010010010 '13000
       word %010010110 '13100
       word %010010100 '13200
       word %010011100 '13300
       word %010011110 '13400
       word %010011010 '13500
       word %010011011 '13600
       word %010011001 '13700
       word %010001001 '13800
       word %010001011 '13900
       word %010001010 '14000
       word %010001110 '14100
       word %010001100 '14200
       word %010000100 '14300
       word %010000110 '14400
       word %010000010 '14500
       word %010000011 '14600
       word %010000001 '14700
       word %110000001 '14800
       word %110000011 '14900
       word %110000010 '15000
       word %110000110 '15100
       word %110000100 '15200
       word %110001100 '15300
       word %110001110 '15400
       word %110001010 '15500
       word %110001011 '15600
       word %110001001 '15700
       word %110011001 '15800
       word %110011011 '15900
       word %110011010 '16000
       word %110011110 '16100
       word %110011100 '16200
       word %110010100 '16300
       word %110010110 '16400
       word %110010010 '16500
       word %110010011 '16600
       word %110010001 '16700
       word %110110001 '16800
       word %110110011 '16900
       word %110110010 '17000
       word %110110110 '17100
       word %110110100 '17200
       word %110111100 '17300
       word %110111110 '17400
       word %110111010 '17500
       word %110111011 '17600
       word %110111001 '17700
       word %110101001 '17800
       word %110101011 '17900
       word %110101010 '18000
       word %110101110 '18100
       word %110101100 '18200
       word %110100100 '18300
       word %110100110 '18400
       word %110100010 '18500
       word %110100011 '18600
       word %110100001 '18700
       word %111100001 '18800
       word %111100011 '18900
       word %111100010 '19000
       word %111100110 '19100
       word %111100100 '19200
       word %111101100 '19300
       word %111101110 '19400
       word %111101010 '19500
       word %111101011 '19600
       word %111101001 '19700
       word %111111001 '19800
       word %111111011 '19900
       word %111111010 '20000
       word %111111110 '20100
       word %111111100 '20200
       word %111110100 '20300
       word %111110110 '20400
       word %111110010 '20500
       word %111110011 '20600
       word %111110001 '20700
       word %111010001 '20800
       word %111010011 '20900
       word %111010010 '21000
       word %111010110 '21100
       word %111010100 '21200
       word %111011100 '21300
       word %111011110 '21400
       word %111011010 '21500
       word %111011011 '21600
       word %111011001 '21700
       word %111001001 '21800
       word %111001011 '21900
       word %111001010 '22000
       word %111001110 '22100
       word %111001100 '22200
       word %111000100 '22300
       word %111000110 '22400
       word %111000010 '22500
       word %111000011 '22600
       word %111000001 '22700
       word %101000001 '22800
       word %101000011 '22900
       word %101000010 '23000
       word %101000110 '23100
       word %101000100 '23200
       word %101001100 '23300
       word %101001110 '23400
       word %101001010 '23500
       word %101001011 '23600
       word %101001001 '23700
       word %101011001 '23800
       word %101011011 '23900
       word %101011010 '24000
       word %101011110 '24100
       word %101011100 '24200
       word %101010100 '24300
       word %101010110 '24400
       word %101010010 '24500
       word %101010011 '24600
       word %101010001 '24700
       word %101110001 '24800
       word %101110011 '24900
       word %101110010 '25000
       word %101110110 '25100
       word %101110100 '25200
       word %101111100 '25300
       word %101111110 '25400
       word %101111010 '25500
       word %101111011 '25600
       word %101111001 '25700
       word %101101001 '25800
       word %101101011 '25900
       word %101101010 '26000
       word %101101110 '26100
       word %101101100 '26200
       word %101100100 '26300
       word %101100110 '26400
       word %101100010 '26500
       word %101100011 '26600
       word %101100001 '26700
       word %100100001 '26800
       word %100100011 '26900
       word %100100010 '27000
       word %100100110 '27100
       word %100100100 '27200
       word %100101100 '27300
       word %100101110 '27400
       word %100101010 '27500
       word %100101011 '27600
       word %100101001 '27700
       word %100111001 '27800
       word %100111011 '27900
       word %100111010 '28000
       word %100111110 '28100
       word %100111100 '28200
       word %100110100 '28300
       word %100110110 '28400
       word %100110010 '28500
       word %100110011 '28600
       word %100110001 '28700
       word %100010001 '28800
       word %100010011 '28900
       word %100010010 '29000
       word %100010110 '29100
       word %100010100 '29200
       word %100011100 '29300
       word %100011110 '29400
       word %100011010 '29500
       word %100011011 '29600
       word %100011001 '29700
       word %100001001 '29800
       word %100001011 '29900
       word %100001010 '30000